<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{frame/myPage}">

<head>
<meta charset="UTF-8">
<meta name="description" content="Ogani Template">
<meta name="keywords" content="Ogani, unica, creative, html">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>MyLikeList</title>

<!-- Google Font -->
<link
	href="https://fonts.googleapis.com/css2?family=Cairo:wght@200;300;400;600;900&display=swap"
	rel="stylesheet">

<!-- Css Styles -->
<link rel="stylesheet" href="/second-template/css/bootstrap.min.css"
	type="text/css">
<link rel="stylesheet" href="/second-template/css/font-awesome.min.css"
	type="text/css">
<!-- <link rel="stylesheet" href="/ogani-master/css/elegant-icons.css" -->
<!-- 	type="text/css"> -->
<!-- <link rel="stylesheet" href="/ogani-master/css/nice-select.css" -->
<!-- 	type="text/css"> -->
<!-- <link rel="stylesheet" href="/ogani-master/css/jquery-ui.min.css" -->
<!-- 	type="text/css"> -->
<!-- <link rel="stylesheet" href="/ogani-master/css/owl.carousel.min.css" -->
<!-- 	type="text/css"> -->
<!-- <link rel="stylesheet" href="/ogani-master/css/slicknav.min.css" -->
<!-- 	type="text/css"> -->
<link rel="stylesheet" href="/second-template/css/style.css"
	type="text/css">

<!-- 리뷰 탭 -->
<link rel="stylesheet"
	href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/assets/css/bootstrap.min_grp.css">
<link rel="stylesheet" href="/assets/css/style_grp.css">

<!-- 인증 모달 -->
<link href="/modal-template/css/style.css" rel="stylesheet">

</head>

<body>
	<div layout:fragment="content" align="center">
		<h4>
			<b>MY LIKE</b>
		</h4>
		<div class="col-lg-10">
			<div class="product__details__tab">
				<ul class="nav nav-tabs" role="tablist">
					<li class="nav-item"><a class="nav-link active"
						data-toggle="tab" href="#community" role="tab"
						aria-selected="true">식단</a></li>
					<li class="nav-item"><a class="nav-link" data-toggle="tab"
						href="#challenge" role="tab" aria-selected="false">챌린지</a></li>
				</ul>

				<!-- 탭 내용들 -->
				<div class="tab-content">
					<!-- 식단 탭 시작 -->
					<div class="tab-pane active" id="community" role="tabpanel">
						<div class="product__details__tab__desc">
							<br><br><br><br>
							<div class="my-3 grid lg:grid-cols-4 grid-cols-2 gap-3 hover:text-yellow-700 uk-link-reset" id="mealLike">

								<!-- 식단 리스트 출력 -->


							</div>
						</div>
						<!-- 식단 탭 끝 -->

						<!-- 식단 모달 시작 -->
						<div id="storyModal" class="uk-modal-container" uk-modal>
							<div class="uk-modal-dialog story-modal">
								<button
									class="uk-modal-close-default lg:-mt-9 lg:-mr-9 -mt-5 -mr-5 shadow-lg bg-white rounded-full p-4 transition dark:bg-gray-600 dark:text-white"
									type="button" uk-close></button>

								<div class="story-modal-media">
									<img src="" alt="" style="width: 820px; height: 820px;"
										class="inset-0 h-full w-full object-cover" id="postImg">
								</div>
								<div class="flex-1 bg-white dark:bg-gray-900 dark:text-gray-100">

									<!-- post header-->
									<div
										class="border-b flex items-center justify-between px-5 py-3 dark:border-gray-600">
										<div class="flex flex-1 items-center space-x-4">
											<a href="#">
												<div
													class="bg-gradient-to-tr from-yellow-600 to-pink-600 p-0.5 rounded-full">
													<img src=""
														class="bg-gray-200 border border-white rounded-full w-8 h-8"
														id="profileImg">
												</div>
											</a> <span class="block text-lg font-semibold" id="nickName"></span>
										</div>
										<a href="#"></a>
									</div>
									<div class="story-content p-4 likeOne" data-simplebar>
											<span><b><span id="typeCode"></span></b>&nbsp;<span id="mealTime"></span>&nbsp;<span id="mealAmount"></span></span>
											<br>
											식단 점수 : <span id="mealScore"></span>
											<br>
											<p id="subject"></p>
<!-- 										<p id="subject"></p> -->

										<div class="py-4 ">
											<div class="flex justify-around">
												<a href="#" class="flex items-center space-x-3 modalHeart">
												</a> <a href="#" class="flex items-center space-x-3">
													<div class="flex font-bold items-baseline">
														<i class="uil-comment mr-1"> </i> Comment
													</div>
												</a>
											</div>
											<hr>
										</div>

										<div class="-mt-1 space-y-1">
											<div class="flex flex-1 items-center space-x-2">
												<img src="assets/images/avatars/avatar-2.jpg"
													class="rounded-full w-8 h-8">
												<div class="flex-1 p-2">댓글 내용1</div>
											</div>

											<div class="flex flex-1 items-center space-x-2">
												<img src="assets/images/avatars/avatar-4.jpg"
													class="rounded-full w-8 h-8">
												<div class="flex-1 p-2">댓글 내용2</div>
											</div>
										</div>
									</div>
									<div class="p-3 border-t dark:border-gray-600">
										<div
											class="bg-gray-200 dark:bg-gray-700 rounded-full rounded-md relative">
											<input type="text" placeholder="Add your Comment.."
												class="bg-transparent max-h-8 shadow-none">
											<div
												class="absolute bottom-0 flex h-full items-center right-0 right-3 text-xl space-x-2">
												<a href="#"> <i class="uil-image"></i></a> <a href="#">
													<i class="uil-video"></i>
												</a>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<!-- 식단 모달 끝 -->

					<!--  챌린지 탭 시작 -->
					<div class="tab-pane" id="challenge" role="tabpanel">
						<div class="product__details__tab__desc">
							<br> <br> <br> <br>
							<div
								class="my-3 grid lg:grid-cols-4 grid-cols-2 gap-3 hover:text-yellow-700 uk-link-reset"
								id="challLike">
								<!-- 챌린지 리스트 출력 -->

							</div>
						</div>
					</div>
					<!-- 종료된 챌린지 탭 끝 -->
				</div>

			</div>
		</div>



		<script>
		
		$('document').ready(function () {

			 $.ajax({
				 url: "/myLikeListAjax",
				 type: 'POST',
				 
				 success: function(result) {
					 console.log(result)
					$.each(result, function(index, list){
						console.log(list)
						$("#mealLike").append( // ``으로 할때는 each 돌아야하는 div의 바로 위 div에 id나 class 하나주고 스크립트에서 $().append -> ``안에 만들거 넣어주면됨
											   // th 같은거 다 빼줘야함
							`					
									<div class="likeOne" data-postno="${list.POST_NO}" id="${list.NO}">
										<div class="lg:h-56 h-48 rounded-lg relative overflow-hidden shadow uk-transition-toggle">
											<div href="#storyModal" uk-toggle>
												<img src="${list.FILE_DIR}" class="w-full h-full absolute object-cover inset-0 scale-150 transform">
											</div>
											<div class="flex flex-1 items-center absolute bottom-0 w-full p-3 text-white">
												<div class="flex space-x-2 flex-1 lg:flex-initial justify-around">
													<a href="#" class="heart-click heart_icon fullHeart" data-no="${list.NO}"> 
														<img src="/assets/images/heart.svg">
													</a>
												</div>
											</div>
										</div>
									</div>
							`	
						)
					}) 
				
					 
				 }
			 })
		})
		
		
		$('document').ready(function(){
			
			$.ajax({
				url: "/challLikeAjax",
				type: 'POST',
				
				success: function(result) {
					console.log(result)
					
					$.each(result, function(index,lists){
						event.stopPropagation()
						event.preventDefault()
						
						console.log(lists)
						$("#challLike").append(
							`
									<div data-no="${lists.NO}" class="tabHeart">
										<div
											class="lg:h-56 h-48 rounded-lg relative overflow-hidden shadow uk-transition-toggle">
											<div href="" uk-toggle>
												<img src="${lists.THUMBNAIL_IMG_PATH}" onclick="location.href='/chlg/challenge/${lists.POST_NO}'"
													class="w-full h-full absolute object-cover inset-0 scale-150 transform">
											</div>
											<div
												class="flex flex-1 items-center absolute bottom-0 w-full p-3 text-white">
												<div
													class="flex space-x-2 flex-1 lg:flex-initial justify-around">
													<a href="#" class="heart-click heart_icon fullHeart"
														data-no="${lists.NO}"> <img
														src="/assets/images/heart.svg">
													</a>
												</div>
											</div>
										</div>
									</div>
							`
						)
					})
				}
			})
		})
		
		
		
		
		
		
		$(function() {
			$(document).on("click", ".likeOne", function(){
				
				event.stopPropagation() // 이벤트 전파중지(현재 이벤트가 상위로 전파되지 않도록 한다)
				event.preventDefault() // a, submit (페이지 이동 막음)
				
				let postNo = $(this).data("postno");
				
				 $(".modalHeart").empty() // 모달안에 반복으로 나타나는 하트 지워줌
						
				$.ajax({
					url: "/myLikeList/" + postNo
				})
				.then(result => {
					console.log(result);
					$("#postImg").attr("src", result.FILE_DIR)
					$("#profileImg").attr("src", result.PROFILE_IMG_PATH)
					$("#nickName").text(result.NICK_NAME)
					$("#subject").text(result.SUBJECT)
					$("#mealScore").text(result.MEAL_SCORE);
					$("#typeCode").text(result.TYPE_CODE);
				    $("#mealTime").text(result.MEAL_TIME);
				    $("#mealAmount").text(result.MEAL_AMOUNT); 
					console.log(result)
					 // 모달안에 좋아요
		            if(result.NO != 0) {  
		            	var newNode = $(`<img src="/assets/images/heart.svg" class="fullHeart" data-no="${result.NO}">`)
		            	newNode.on("click", function(){
										let divHeart = $(this);
										let no = $(this).data("no");
									//	event.stopPropagation() // 이벤트 전파중지(현재 이벤트가 상위로 전파되지 않도록 한다)
										
										$.ajax({
											type: 'POST',
											url: "/myLikeDel/" + no
										})
										.then(obj => {
											UIkit.modal("#storyModal").hide();
										//	divHeart.closest(".tabHeart").remove()
					
										});
			});
		            	$(".modalHeart").append( newNode  )
		            	
		            } 
				});
				
			});
			

			
			// 좋아요 삭제	
			$(document).on("click", ".fullHeart",  function(){
					let divHeart = $(this);
					let no = $(this).data("no"); // no 변수를 먼저 선언해놔야함
					let like = $('#' + no); // no 변수를 넣어서 해당 id를 찾아서 알려주고 뒤에 변수 담은 값을 넣어주면 #뭐뭐 로 찾아옴
					
					event.stopPropagation() 
					event.preventDefault() 
					
					$.ajax({
						type: 'POST',
						url: "/myLikeDel/" + no
					})
					.then(obj => {
						like.remove() // 변수선언해서 담은 객체를 지워줌
						divHeart.closest(".tabHeart").remove() // divHeart의 조상인 tabHeart class 본인 포함 전부 지움(부른 대상 포함)
					});
			});
		});
		</script>


		<!-- Js Plugins -->
		<!-- 		<script src="/ogani-master/js/jquery-3.3.1.min.js"></script> -->
		<script src="/second-template/js/bootstrap.min.js"></script>
		<!-- 		<script src="/ogani-master/js/jquery.nice-select.min.js"></script> -->
		<!-- 		<script src="/ogani-master/js/jquery-ui.min.js"></script> -->
		<!-- 		<script src="/ogani-master/js/jquery.slicknav.js"></script> -->
		<!-- 		<script src="/ogani-master/js/mixitup.min.js"></script> -->
		<!-- 		<script src="/ogani-master/js/owl.carousel.min.js"></script> -->
		<!-- 		<script src="/ogani-master/js/main.js"></script> -->
	</div>
</body>

</html>