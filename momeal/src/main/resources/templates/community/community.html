<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout}">
<head>
<meta charset="UTF-8">
<title>community</title>

<script>
// $();
</script>

</head>
<body>
	<div layout:fragment="content">

		<!-- 게시판이름 -->
		<h1
			class="font-extrabold leading-none mb-6 mt-8 lg:text-2xl text-lg text-gray-900 tracking-tight">
			추천 피드</h1>

		<!-- 슬라이드 시작 -->
		<div class="relative" uk-slider="finite: true">

			<div class="uk-slider-container pb-3 -ml-3">

				<ul
					class="uk-slider-items uk-child-width-1-2 uk-child-width-1-3@s uk-child-width-1-5@m uk-grid-small">
					<li th:each="cmnt : ${cmntList}">
						<div class="oneCmnt" th:data-cmntno="${cmnt.NO}" th:data-feedid="${cmnt.USER_ID}">
							<!-- th:data-여기대문자적으면안됨! -->
							<div
								class="bg-blue-400 max-w-full lg:h-64 h-40 rounded-md relative overflow-hidden shadow-sm">
								<a href="#story-modal" uk-toggle> <img
									th:src="${cmnt.FILE_DIR}"
									class="w-full h-full absolute object-cover inset-0">
								</a>
								<div
									class="absolut absolute bottom-0 flex items-center justify-between px-4 py-3 space-x-2 text-white w-full custom-overly1">
									<a href="#">Jesse </a>
									<div class="flex space-x-3">
										<a href="#" class="flex items-center"> <ion-icon
												name="heart" class="mr-1 md hydrated" role="img"
												aria-label="heart"></ion-icon> 150
										</a> <a href="#" class="flex items-center"> <ion-icon
												name="chatbubble-ellipses" class="mr-1 md hydrated"
												role="img" aria-label="chatbubble ellipses"></ion-icon> 30
										</a>
									</div>
								</div>
							</div>
						</div>
					</li>
				</ul>

				<a
					class="uk-position-center-left uk-position-small p-3.5 bg-white rounded-full w-10 h-10 flex justify-center items-center -mx-4 mb-6 shadow-md dark:bg-gray-800 dark:text-white"
					href="#" uk-slidenav-previous uk-slider-item="previous"></a> <a
					class="uk-position-center-right uk-positsion-small p-3.5 bg-white rounded-full w-10 h-10 flex justify-center items-center -mx-4 shadow-md dark:bg-gray-800 dark:text-white"
					href="#" uk-slidenav-next uk-slider-item="next"></a>

			</div>

		</div>
		<!-- 슬라이드 끝 -->



		<br> <br>



		<!-- 전체 이미지 -->
		<div
			class="my-3 grid lg:grid-cols-5 grid-cols-2 gap-3 hover:text-yellow-700 uk-link-reset">
			<!-- 한 블럭 시작 -->
			<div th:each="cmnt : ${cmntList}" class="oneCmnt"
				th:data-cmntno="${cmnt.NO}" th:data-feedid="${cmnt.USER_ID}">
				<div
					class="bg-blue-400 max-w-full lg:h-64 h-40 rounded-md relative overflow-hidden shadow-sm">
					<a href="#story-modal" uk-toggle> <img
						th:src="${cmnt.FILE_DIR}"
						class="w-full h-full absolute object-cover inset-0">
					</a>
					<div
						class="absolut absolute bottom-0 flex items-center justify-between px-4 py-3 space-x-2 text-white w-full custom-overly1">
						<a href="#">Jesse </a>
						<div class="flex space-x-3">
							<a href="#" class="flex items-center"> <ion-icon name="heart"
									class="mr-1 md hydrated" role="img" aria-label="heart"></ion-icon>
								150
							</a> <a href="#" class="flex items-center"> <ion-icon
									name="chatbubble-ellipses" class="mr-1 md hydrated" role="img"
									aria-label="chatbubble ellipses"></ion-icon> 30
							</a>
						</div>
					</div>
				</div>
			</div>
			<!-- 한 블럭 끝 -->

			<!-- 전체 이미지 끝 -->



			<!-- 스토리 모달 시작 -->
			<div id="story-modal" class="uk-modal-container" uk-modal>
				<div class="uk-modal-dialog story-modal">
					<button
						class="uk-modal-close-default lg:-mt-9 lg:-mr-9 -mt-5 -mr-5 shadow-lg bg-white rounded-full p-4 transition dark:bg-gray-600 dark:text-white"
						type="button" uk-close></button>

					<div class="story-modal-media">
						<img src="" alt="" style="width: 820px; height: 820px;"
							class="inset-0 h-full w-full object-cover" id="cmntImg">
					</div>
					<div class="flex-1 bg-white dark:bg-gray-900 dark:text-gray-100">

						<!-- post header-->
						<div
							class="border-b flex items-center justify-between px-5 py-3 dark:border-gray-600">
							<div class="flex flex-1 items-center space-x-4">
								<a href="#">
									<div
										class="bg-gradient-to-tr from-yellow-600 to-pink-600 p-0.5 rounded-full">
										<img id ="feedFrofile" src=""
											class="bg-gray-200 border border-white rounded-full w-8 h-8">
									</div>
								</a> <span id="nickName" class="block text-lg font-semibold"></span>
							</div>
<!-- 							<input type="hidden" th:data> -->
							<th:block th:if = "${session.userId != null}">
<!-- 								<a href="">  -->
									<!-- 팔로우  -->
<!-- 									<th:block th:if ="" id="followChk"> -->
<!-- 									<div id="sessionId"> -->
										<button type="button" id="followBtn">팔로우</button>
										<input type="hidden" id="feedUserId">
<!-- 									</div> -->
<!-- 									</th:block> -->
<!-- 									<th:block th:unless ="" id="followChk2"> -->
										<button type="button" id="unfollowBtn">언팔로우</button>
<!-- 									</th:block> -->
<!-- 								</a> -->
							</th:block>
						</div>
						<div class="story-content p-4" data-simplebar>

							<div id="subject"></div>

							<div class="py-4 ">
								<div class="flex justify-around">
									<a href="#" class="flex items-center space-x-3">
										<div class="flex font-bold items-baseline">
											<i class="uil-heart mr-1"> </i> Like
										</div>
									</a> <a href="#" class="flex items-center space-x-3">
										<div class="flex font-bold items-baseline">
											<i class="uil-heart mr-1"> </i> Comment
										</div>
									</a>
								</div>
								<hr class="-mx-4 my-3">
<!-- 								<div class="flex items-center space-x-3"> -->
<!-- 									<div class="flex items-center"> -->
<!-- 										<img src="assets/images/avatars/avatar-1.jpg" alt="" -->
<!-- 											class="w-6 h-6 rounded-full border-2 border-white"> <img -->
<!-- 											src="assets/images/avatars/avatar-4.jpg" alt="" -->
<!-- 											class="w-6 h-6 rounded-full border-2 border-white -ml-2"> -->
<!-- 										<img src="assets/images/avatars/avatar-2.jpg" alt="" -->
<!-- 											class="w-6 h-6 rounded-full border-2 border-white -ml-2"> -->
<!-- 									</div> -->
<!-- 									<div> -->
<!-- 										Liked <strong> Johnson</strong> and <strong> 209 -->
<!-- 											Others </strong> -->
<!-- 									</div> -->
<!-- 								</div> -->
							</div>

							<div class="-mt-1 space-y-1" id="reply">
								<!-- <div class="flex flex-1 items-center space-x-2">
									<img src="assets/images/avatars/avatar-2.jpg"
										class="rounded-full w-8 h-8">
									<div class="flex-1 p-2">댓글</div>
								</div> -->
							</div>


						</div>
						<div class="p-3 border-t dark:border-gray-600">
							<div
								class="bg-gray-200 dark:bg-gray-700 rounded-full rounded-md relative">
								<input type="text" placeholder="Add your Comment.."
									class="bg-transparent max-h-8 shadow-none">
								<div
									class="absolute bottom-0 flex h-full items-center right-0 right-3 text-xl space-x-2">
									<a href="#"> <i class="uil-image"></i></a> <a href="#"> <i
										class="uil-video"></i></a>
								</div>
							</div>
						</div>

					</div>

				</div>
			</div>
		</div>
		<!-- 스토리 모달 끝 -->
	<script>
		// 세션 아이디 값 받아오기
		// let userId = '<%=(String)session.getAttribute("userId")%>';
		
// 		let userId = sessionStorage.getItem("userId");
		
	
	
		// ▶ 커뮤니티 게시글 단건 조회 ajax
		$(".oneCmnt").on("click", function() {
			console.log("왔니...........");
			console.log($(this));
			let no = $(this).data("cmntno"); // 대소문자 구분 안됨. cmntno는 변수가 아니니까(?) ""안에 넣어주기
			console.log(no);

			var userId = $(this).data("feedid");
			console.log("아이디 ============== " + userId)
			
			$.ajax({
				url: "/community/" + no
			})
			.then(obj => { // 넘어오는 결과값 자체가 json 타입
				console.log(obj);
				$("#cmntImg").attr("src", obj.fileDir);
				$("#subject").text(obj.subject);
				$("#nickName").text(obj.nickName);
				$("#feedFrofile").attr("src", obj.profileImgPath);
				$("feedUserId").attr("th:data-feedid", obj.userId);
				
// 				$("#followChk").attr("th:if", obj.userId != userId);
				
			commentList(no);
		});
	});
		

		// ▶ 댓글, 대댓글 ajax
		function commentList(postNo) {
			console.log("글번호 =========" + postNo)
			$.ajax({
				url: "/comment/" + postNo,
				type: 'post',
				dataType: 'json',   // 데이터 타입을 Json으로 변경
				contentType: 'application/json'   // Content-Type을 Json으로 변경
			})
			.then(data => {
				console.log("댓글 ======== " + data);
				
				$(data).each(function(index, item) {
					console.log(item.profileImgPath);
					$("#reply").append(
						`<div class="flex flex-1 items-center space-x-2">
									<img th:src="${item.profileImgPath}"
										class="rounded-full w-8 h-8">
									<div class="flex-1 p-2"><p>${item.subject}</p></div>
								</div>`
					)
				});
				
			})
		};
		
		
		// ▶ 팔로잉 기능
		// 팔로우 / 언팔로우 확인
		$("#followBtn").on("click", function() {
			follow(true);
		});

		$("#unfollowBtn").on("click", function() {
			follow(false);
		});

		// 팔로잉 처리 ajax
		function follow(check) {
// 			console.log("아작스에도 왔남요 ===== " + userId);
			
			// 팔로잉 상태가 아니라면 팔로잉 처리 해주기
			if(check) {
				$.ajax ({
					type: 'post',
					url: '/follow/user1', // 피드 유저의 id를 넘겨줘야함
					dataType: 'json',   // 데이터 타입을 Json으로 변경
					contentType: 'application/json'   // Content-Type을 Json으로 변경
				})
				.then(result => {
					console.log(result)
					if(result == "FollowOK") {
						console.log()
					}
				})
			}
		}

		// 
	</script>
	</div>
</body>
</html>