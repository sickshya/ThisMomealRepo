<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="co.doeat.community.mapper.GroupsMapper">


	<resultMap type="co.doeat.community.service.GroupsVO"
		id="groupsImg">
		<collection property="mealsImg" select="imgList"
			column="user_id" ofType="co.doeat.activity.service.MealVO"
			javaType="ArrayList" />
	</resultMap>


	<!-- 그룹 전체리스트 출력 -->
	<select id="groupsList" resultMap="groupsImg">
		SELECT U.USER_ID, U.USER_NAME,
		U.NICK_NAME, U.PROFILE_IMG_PATH, GM.*, GL.*
		FROM USERS U
		JOIN
		GROUP_MEMBER GM ON (U.USER_ID = GM.USER_ID)
		JOIN GROUP_LISTS GL ON
		(GM.NO = GL.NO)
	</select>

	<select id="imgList"
		resultType="co.doeat.activity.service.MealVO">
		SELECT M.*
		FROM MEALS M
		WHERE TRUNC(post_date) =
		TO_DATE('20230306', 'yyyyMMdd')
		AND M.USER_ID =
		#{userId}
		ORDER BY M.NO
	</select>

	<!-- 그룹 단건조회 -->
	<select id="groupsSelect" resultType="map">
		SELECT U.USER_ID,
		U.USER_NAME, U.NICK_NAME, U.PROFILE_IMG_PATH, M.*, GM.*,
		GL.*
		FROM USERS
		U LEFT JOIN MEALS M ON(U.USER_ID = M.USER_ID)
		LEFT JOIN GROUP_MEMBER GM
		ON (M.USER_ID = GM.USER_ID)
		LEFT JOIN GROUP_LISTS GL ON (GM.NO = GL.NO)
		WHERE TRUNC(post_date) =
		TO_DATE(#{postDate},'yyyyMMdd') AND M.USER_ID
		= #{userId} AND M.NO = #{no}
	</select>

	<!-- 그룹 즐겨찾기 추가 -->
	<insert id="insertGroups">

	</insert>
</mapper>